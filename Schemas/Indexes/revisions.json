{
    "2743bf18-3b86-4721-bf3e-153dcda0b149": {
        "name": "Azure - Valid Credentials",
        "object": "Threat Vectors",
        "description": "This threat vector within the Initial Access phase represents a significant risk \nin Azure environments. This attack technique\u2014formally designated around adversaries \nacquiring and abusing legitimate authentication credentials to gain access to Azure \nresources or Azure Active Directory (AzureAD).\n\n### Example Attack Scenario\n\n- The attacker logs in directly to the Azure Portal or via CLI (e.g., `az login`) \nusing valid credentials.\n- Once inside, the attacker can enumerate resources, exfiltrate data, manipulate \nconfigurations, or leverage the account for further attacks, depending on the permissions \ngranted to the compromised account.\n- If privileged service principal credentials are obtained, the attacker can use \nsecrets or certificates to automate access and escalate privileges.\n\n### Attack Goals and Impact\n\n- **Primary Goals:**\n  - Establish initial access to Azure environments in a stealthy, low-noise manner \n  by using valid, non-malicious authentication flows.\n  - Access sensitive data, manipulate cloud resources, and potentially escalate \n  privileges or persist within the target environment.\n\n- **Impact:**\n  - Complete compromise of Azure resources accessible by the stolen account (files, \n  databases, VMs, identity services, etc.).\n  - Potential for privilege escalation if the account is eligible for higher roles \n  or Privileged Identity Management (PIM).\n  - Ability to create backdoors, perform lateral movement, and evade detection (since \n  all actions appear legitimate).\n  - Depending on account privileges, ransomware deployment, data exfiltration, and \n  broad access to organizational assets may occur.\n\n### Attack Flow and Methodology\n\n1. **Reconnaissance**\n  - Attackers gather information on users or service principals, identifying potential \n  targets through open-source intelligence, misconfigurations, or enumeration of \n  publicly accessible resources.\n\n2. **Credential Acquisition**\n  - Common methods: phishing (email/SMS/voice), brute-force/password spraying, \n  harvesting credentials from previous breaches, or exploiting cloud API/application \n  misconfigurations.\n  - Service principal secrets/certificates may be obtained from publicly accessible \n  repositories, misconfigured code, or automation scripts.\n\n3. **Authentication**\n  - Adversary logs into Azure Portal or invokes cloud APIs using the acquired credentials.\n  - For service principals: authentication occurs via CLI or programmatic access \n  using certificates/secrets.\n\n4. **Enumeration and Expansion**\n  - Mapping out resources, roles, permissions; searching for sensitive data or \n  additional high-value targets.\n  - Assessing role activation and privilege escalation opportunities (e.g., via \n  PIM or RBAC misconfigurations).\n\n5. **Execution of Attack Objectives**\n  - Data exfiltration, sabotage, account persistence (creating additional user \n  accounts or credentials), lateral movement to other resources, or exploitation \n  for financial gain.\n  - Actions are typically performed under the guise of the legitimate account to \n  avoid detection.\n\n6. **Persistence and Defense Evasion**\n  - Adversaries may create new accounts, modify access policies, or abuse automation \n  to ensure continued access.\n  - Use of valid credentials enables attackers to blend with legitimate user activity, \n  thus evading many traditional security detection systems.\n",
        "revisions": {
            "2": {
                "date": "2025-10-22",
                "message": "Sample Commit Message",
                "author": "Sample Commit Author",
                "commit": "Sample Commit SHA"
            }
        }
    },
    "bdc58fee-8da6-4fc9-8fbd-30f8fd156bc7": {
        "name": "Powershell with encoded payload passed to cmdline",
        "object": "Threat Vectors",
        "description": "When working with PowerShell, a threat actor can encode a command or script\nusing Base64 or other type of encoding and pass it as a parameter to the\ncommand line. This technique is useful for obfuscating sensitive\ninformation or executing complex commands. (ref [1])  \n\nOther possible examples for encoding with PowerShell commands: \n\nEncoding a Command with Base64\n\n1. Create a command as a string. \n\n```\n$command = 'dir \"C:\\Program Files\"'\n```\n\n2. Convert the command to Base64:\n\n```pwsh\n$bytes = [System.Text.Encoding]::Unicode.GetBytes($command)\n$encodedCommand = [Convert]::ToBase64String($bytes)\n```\n\nNow you can run the encoded command using powershell.exe:\n\n```\npowershell.exe -encodedCommand $encodedCommand\n```\n\nIt's also possible to encode domain names, for example: \n\nPowershell input:\n\n```pwsh\n[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes(\"'sample_domain.com'\"))\n```\n\nThreat actors also use PowerShell scripts for faster encoding process and result.  \n\nAn example of Powershell script (ref [2])  \n\n```pwsh\nparam(\n[Parameter()][Alias(\"un\")][string]$Username,\n[Parameter()][Alias(\"pw\")][string]$Password\n)\n\nWrite-Host \"Username: $Username\"\nWrite-Host \"Password: $Password\"\n```",
        "revisions": {
            "1": {
                "date": "2025-10-17",
                "message": "Sample Commit Message",
                "author": "Sample Commit Author",
                "commit": "Sample Commit SHA"
            }
        }
    },
    "cf9c69a2-9317-4f0f-9506-fbeeb1c73ff0": {
        "name": "Powershell encoded payload to start new process",
        "object": "Detection Models",
        "description": "Adversaries use PowerShell to execute local scripts and execute remote resources \nafter retrieving them using multiple network protocols. They can also encode payloads \nusing the command line and load PowerShell into other processes.\n\nHere are some examples of encoded PowerShell payloads and how they can be detected:\n\n### Base64-Encoded Payload\n\n#### background\n\nA common technique is to encode the entire PowerShell script in Base64 and execute it using \nthe -encodedcommand switch.\n\nTo detect this, look for:\n- Execution of powershell.exe with encode arguments\n- The presence of base64 string in the command line\n\n#### detection strategies\n\nto detect base64encoded string, you may use REGEX and then you may have the \noption on the detection platform to decode the base64 encoded string to \nconfirm the actions done.  \n\nWhen focusing on specific keywords within the encoded string, a very good\napproach is to precompute the base64 encoded version of the keyword and \nsearch for that pattern in strings. To precompute the base64 string, 3 \nscenario have to be considered:\n- the keyword is at a boundary of a 3-character block\n- the keyword starts at second character of a 3-character block\n- the keyword starts at the third character of 3-character block\n\nMalicious payloads are often encoded and obfuscated, with PowerShell commands frequently \nused to download them from the internet. To detect encoded and downloadable command line \narguments, it is essential to examine PowerShell logs, such as Sysmon or Windows PowerShell logs, \nfor the presence of specific keywords like \"Net.WebClient,\" \"DownloadFile,\" \"Invoke-WebRequest,\" \n\"Invoke-Shellcode,\" \"http:,\" \"-enc,\" \"-encodedCommand,\" \"-e,\" \"-ec,\" \"-en,\" \"-encod,\" and \"-enco\".  \n\nAdditionally, you can visit the following page to access a PowerShell Watchlist that helps with detection. [4]  \n\nFor example, this CDM attemtps to detect the launch of a process \nusing the cmdlet \"Start-Process\". Preprocessing this keyword gives \nthe following search strings (without decoding base64 nor REGEX)\n\n| Keyword | offset | string (with leading _ or *) | search string |\n| --- | --- | --- | --- |\n| Start-Process | 0 | U3RhcnQtUHJvY2Vzcw== | U3RhcnQtUHJvY2Vz |\n| Start-Process | 1 | X1N0YXJ0LVByb2Nlc3M= / KlN0YXJ0LVByb2Nlc3M= | N0YXJ0LVByb2Nl |\n| Start-Process | 2 | X19TdGFydC1Qcm9jZXNz / KipTdGFydC1Qcm9jZXNz | TdGFydC1Qcm9jZXNz |\n    \n### Obfuscated Payload with Special Characters\n\nAdversaries may also obfuscate the PowerShell script using special characters.\n\nTo detect this, look for:\n- Execution of powershell.exe with the -nop, -w hidden, and -c arguments\n- High counts of obfuscation characters like `, `, and '\n\nUseful telemetry will include:\n\n- Windows Security Event ID 400: PowerShell command-line logging\n- Windows Security Event IDs 800 and 4103: Module loading and Add-Type logging\n- Windows Security Event ID 4688 : A new process has been created including process command-line\n- Sysmon Event IDs 1 and 7: Process creation and Image loaded\n",
        "revisions": {
            "2": {
                "date": "2025-10-17",
                "message": "Sample Commit Message",
                "author": "Sample Commit Author",
                "commit": "Sample Commit SHA"
            }
        }
    },
    "f4a8b3c2-7e5d-4f1a-bc8e-9d2a6e7c8f0b": {
        "name": "Detect Abuse of Valid Azure Credentials",
        "object": "Detection Objectives",
        "description": "Detect when adversaries abuse valid Azure AD/Entra ID credentials to gain \nunauthorized access to cloud resources. This detection objective focuses on \nidentifying anomalous authentication patterns, suspicious access behaviors, \nand privilege abuse that indicate compromised credentials are being used \nfor malicious purposes.\n\nAttackers obtain credentials through various means (phishing, password spraying, \ncredential leaks) and use them to authenticate legitimately to Azure services, \nmaking detection challenging as the authentication itself appears valid. This \nobjective aims to identify the contextual anomalies and behavioral indicators \nthat differentiate legitimate use from credential abuse.\n\nKey focus areas include:\n- Anomalous sign-in patterns (location, device, time, velocity)\n- Privilege escalation attempts post-authentication\n- Unusual resource access patterns\n- Service principal and application credential abuse\n- Cross-tenant authentication anomalies\n",
        "revisions": {
            "1": {
                "date": "2025-10-22",
                "message": "Sample Commit Message",
                "author": "Sample Commit Author",
                "commit": "Sample Commit SHA"
            }
        }
    },
    "0be66eea-4ae4-4544-811b-52651e20d744": {
        "name": "RBA_RR - WIN base64 encoded powershell payload",
        "object": "Detection Rules",
        "description": "Detect base64 encoded PowerShell payload that could be used to launch \na process or a script.\nThe detection applies up to 2 levels of encoded payload (a first payload \ncontaining a PowerShell command with a second base64 payload).  \n\n### Splunk(Sentinel) investigation guidelines ###\n\nThe alert notification contains\n- host(src_host): the host on which the process was launched.\n- src_user: the account used.\n- ParentProcessName(parent_process): the process launching the PS with base64 payload.\n- NewProcessName(process): PS.\n- CommandLine(command_line): the original command line as seen in logs.\n- payload_b64_ascii [and payload_b64]: the first level of encoded payload. \nThey are always present.\n- payload_level2_b64_ascii [and payload_level2_b64] may also be provided \nif the first level was containing another base64 encoded payload.\nFor Sentinel Alert, you have to decode the base64 string present in command_line field,\nusing CyberChef or any base64 decoding tool.  \n\n### SENTINEL alerts triage ###\nCATCH uses TIDE_LD_005_CSIRC_WL_Win_Base64_Encoded_PS_Payload.csv\nto filter legitimate or benign base64 encoded payloads used by PowerShell \non EC Windows devices running on our Azure IaaS & PaaS tenant.\n\n### ES-SPLUNK alerts triage ###\nCATCH uses SOC_LT_289_WIN_reviewed_base64_encoded_payload-exclude.csv\nto filter legitimate or benign base64 encoded payloads used by PowerShell \non EC Windows devices.\n",
        "revisions": {
            "6": {
                "date": "2025-10-17",
                "message": "Sample Commit Message",
                "author": "Sample Commit Author",
                "commit": "Sample Commit SHA"
            }
        }
    }
}